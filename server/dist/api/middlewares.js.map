{"version":3,"file":"middlewares.js","names":["loginRequired","req","res","next","header","status","send","message","try_token","split","token","verifyToken","err","payload","UserModel","findById","sub","exec","user","error","password"],"sources":["../../src/api/middlewares.js"],"sourcesContent":["import UserModel from '../user/model';\nimport token from '../util/token';\n\nexport default {\n  loginRequired: (req, res, next) => {\n    if (!req.header('Authorization')) return res.status(401).send({message: 'Please make sure your request has an Authorization header.'});\n    \n    // Validate jwt\n    let try_token = req.header('Authorization').split(' ')[0];\n    token.verifyToken(try_token, (err, payload) => {\n      if (err) return res.status(401).send(err);\n      UserModel.findById(payload.sub)\n        .exec((err, user) => {\n          if (err || !user) {\n              return res.status(404).send(err || {\n                  error: 'middleware User not found!!!'\n              });\n          }\n          delete user.password;\n          req.user = user;\n          next();\n        })\n    })\n  }\n}"],"mappings":";;;;;;AAAA;AACA;AAAkC;AAAA,eAEnB;EACbA,aAAa,EAAE,uBAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAK;IACjC,IAAI,CAACF,GAAG,CAACG,MAAM,CAAC,eAAe,CAAC,EAAE,OAAOF,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAACC,OAAO,EAAE;IAA4D,CAAC,CAAC;;IAEtI;IACA,IAAIC,SAAS,GAAGP,GAAG,CAACG,MAAM,CAAC,eAAe,CAAC,CAACK,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACzDC,iBAAK,CAACC,WAAW,CAACH,SAAS,EAAE,UAACI,GAAG,EAAEC,OAAO,EAAK;MAC7C,IAAID,GAAG,EAAE,OAAOV,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAACM,GAAG,CAAC;MACzCE,iBAAS,CAACC,QAAQ,CAACF,OAAO,CAACG,GAAG,CAAC,CAC5BC,IAAI,CAAC,UAACL,GAAG,EAAEM,IAAI,EAAK;QACnB,IAAIN,GAAG,IAAI,CAACM,IAAI,EAAE;UACd,OAAOhB,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAACM,GAAG,IAAI;YAC/BO,KAAK,EAAE;UACX,CAAC,CAAC;QACN;QACA,OAAOD,IAAI,CAACE,QAAQ;QACpBnB,GAAG,CAACiB,IAAI,GAAGA,IAAI;QACff,IAAI,EAAE;MACR,CAAC,CAAC;IACN,CAAC,CAAC;EACJ;AACF,CAAC;AAAA"}